<!doctype html>
<html> 
<head>
  <meta charset="UTF-8">
  <title>Dispersals</title>
  <link href="css/dispersals/style.css" rel="stylesheet" type="text/css">
  <link href="css/dispersals/theme.css" rel="stylesheet" type="text/css">

  <!-- Styles -->
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #000;
      font-family: sans-serif;
    }

    #container {
      display: flex;
      height: 100vh;
      width: 100%;
    }

    #header {
      width: 8%;
      background: #000;
      color: white;
      padding: 10px;
      box-sizing: border-box;
    }

    #map {
      flex: 1;
      margin: 20px;
    }
  </style>

  <!-- Google Maps API -->
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_D3tK3uO3Kk83wz7n7QAFSrKU0qB-ULU&callback=initMap&v=beta&libraries=marker">
  </script>
</head>

<body> 	
<div id="container">
  <!-- Left header box -->
  <div id="lfthd" style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
    <!-- Header image -->
    <a href="index.html">
      <img src="Images/Oyo Disp.png" id="header-img" style="display: block; margin: 0 auto;">
    </a>

    <!-- Submit button (triggers modal) -->
    <img id="submit-dispersal-btn" src="Images/Submit Dispersal.svg" style="width: 100px; height: auto; cursor: pointer;">

    <!-- Info container -->
    <div id="info-container" style="display: flex; flex-direction: column; align-items: center; gap: 5px; width: 100%;">
      <p style="font-family: 'CaslonAntique', serif; text-align: center; font-size: 20px; margin: 0;">Running Count:</p>
      <p style="font-family: 'CaslonAntique', serif; text-align: center; font-size: 36px; margin: 0;">1</p>
      <p style="font-family: 'CaslonAntique', serif; margin: 10px 0 0 0; text-align: center; width: 100%; opacity: 0.8">About Dispersals:</p>
      <p style="font-family: 'CaslonAntique', serif; margin: 10px 0 0 0; text-align: center; width: 100%; opacity: 0.8">
        Lorem ipsum dolem ipsum dolem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur et leo nec leo varius tincidunt.
      </p>
    </div>
  </div>

  <!-- Map -->
  <div id="map"></div>
</div>

<!-- Modal Popup -->
<div id="dispersal-modal" style="
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
  z-index: 9999;
">
  <div style="
    position: relative;
    background: #1C1C1C;
    border-radius: 20px;
    padding: 20px 25px;
    width: 350px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 15px;
    color: white;
    font-family: 'CaslonAntique', serif;
  ">
    <!-- Question Mark -->
    <a href="submissions.html" title="Help" style="
      position: absolute;
      top: 10px;
      left: 15px;
      font-size: 10px;
      text-decoration: none;
      color: white;
      opacity: 0.6;
    ">?</a>

    <!-- Input 1 -->
    <div>
      <div id="char1" style="font-size: 12px; opacity: 0.6;">0 / 50</div>
      <input id="input1" type="text" maxlength="50" placeholder="..." style="
        width: 100%;
        border: none;
        border-radius: 25px;
        padding: 8px 12px;
        box-sizing: border-box;
        font-family: 'CaslonAntique', serif;
      ">
    </div>

    <!-- Input 2 -->
    <div>
      <div id="char2" style="font-size: 12px; opacity: 0.6;">0 / 50</div>
      <input id="input2" type="text" maxlength="50" placeholder="..." style="
        width: 100%;
        border: none;
        border-radius: 25px;
        padding: 8px 12px;
        box-sizing: border-box;
        font-family: 'CaslonAntique', serif;
      ">
    </div>

    <!-- Input 3 -->
    <div>
      <div id="char3" style="font-size: 12px; opacity: 0.6;">0 / 50</div>
      <input id="input3" type="text" maxlength="50" placeholder="..." style="
        width: 100%;
        border: none;
        border-radius: 25px;
        padding: 8px 12px;
        box-sizing: border-box;
        font-family: 'CaslonAntique', serif;
      ">
    </div>

    <!-- Submit -->
    <button id="send-btn" style="
      border: none;
      border-radius: 25px;
      padding: 8px;
      background-color: #2E2E2E;
      color: white;
      cursor: pointer;
      font-family: 'CaslonAntique', serif;
    ">Send</button>
  </div>
</div>

<script>
  const modal = document.getElementById('dispersal-modal');
  const openBtn = document.getElementById('submit-dispersal-btn');
  const sendBtn = document.getElementById('send-btn');
  const inputs = [
    { el: document.getElementById('input1'), counter: document.getElementById('char1') },
    { el: document.getElementById('input2'), counter: document.getElementById('char2') },
    { el: document.getElementById('input3'), counter: document.getElementById('char3') }
  ];

  // Open modal
  openBtn.addEventListener('click', () => {
    modal.style.display = 'flex';
  });

  // Close modal on backdrop click
  modal.addEventListener('click', e => {
    if (e.target === modal) modal.style.display = 'none';
  });

  // Close modal on Escape key
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') modal.style.display = 'none';
  });

  // Update character counters
  inputs.forEach(({el, counter}) => {
    el.addEventListener('input', () => {
      counter.textContent = `${el.value.length} / ${el.maxLength}`;
    });
  });

  // Send action to Vercel endpoint
  sendBtn.addEventListener('click', async () => {
    const values = inputs.map(i => i.el.value.trim());
    if (values.some(v => !v)) {
      alert('Please fill in all 3 fields.');
      return;
    }

    try {
      await fetch('/api/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          field1: values[0],
          field2: values[1],
          field3: values[2]
        })
      });
      modal.style.display = 'none';
      inputs.forEach(i => i.el.value = '');
      inputs.forEach(({counter}) => counter.textContent = `0 / 50`);
    } catch (err) {
      console.error(err);
      alert('Submission failed');
    }
  });

  // Google Map
  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 37.7749, lng: -122.4194 },
      zoom: 15,
      mapTypeId: 'satellite',
      disableDefaultUI: true,
      gestureHandling: "greedy",
      backgroundColor: '#000000',
      zoom: 4,
    });

    const marker = new google.maps.Marker({
      position: { lat: 37.7749, lng: -122.4194 },
      map: map,
      title: "Disp 1"
    });

    const pages = [
      `<p>Page 1: Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>`,
      `<p>Page 2: Cras placerat ultricies felis, in fermentum urna dapibus sed.</p>`,
      `<p>Page 3: Sed ut perspiciatis unde omnis iste natus error sit voluptatem.</p>`
    ];

    let currentPage = 0;

    const infowindow = new google.maps.InfoWindow({
      content: `
        <div style="display:flex;flex-direction:column;background:black;color:white;font-family:'CaslonAntique',serif;border-radius:8px;padding:10px;max-width:380px;">
          <!-- content omitted for brevity; same as original infowindow content -->
        </div>`
    });

    infowindow.addListener("domready", () => {
      // Carousel and text navigation code (same as your original)
    });

    marker.addListener("click", () => {
      infowindow.open(map, marker);
    });
  }
</script>
</body>
</html>